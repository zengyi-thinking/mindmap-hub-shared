# 功能重复与冗余清理计划

本文档详细说明项目中功能重复与冗余的清理计划，包括目录合并、冗余代码删除和导入路径更新等任务。

## 1. 已完成的工作

### 1.1 领域迁移

- ✅ 材料领域(Materials)已迁移到`domains/materials`目录
- ✅ 讨论领域(Discussions)已迁移到`domains/discussions`目录
- ✅ 为这些领域创建了桥接组件，保持向后兼容性

## 2. 待处理的功能重复与冗余

### 2.1 目录合并

以下目录存在功能重复，需要合并：

| 源目录                                                    | 目标目录                  | 状态      |
| --------------------------------------------------------- | ------------------------- | --------- |
| `features/materials`                                      | `domains/materials`       | ⏳ 进行中 |
| `features/discussions` + `features/discussion`            | `domains/discussions`     | ⏳ 进行中 |
| `features/material-search` + `components/material-search` | `domains/material-search` | 🔍 计划中 |
| `shared` + `components/shared`                            | `shared`                  | 🔍 计划中 |

### 2.2 移除冗余目录

完成迁移后，以下目录将变得冗余，应逐步移除：

- [ ] `src/modules` - 所有功能迁移到 domains 后移除
- [ ] `src/features` - 所有功能迁移到 domains 后移除

## 3. 导入路径更新计划

### 3.1 更新策略

为确保代码正确性，导入路径更新采用渐进式策略：

1. **识别阶段**：使用 grep 等工具识别所有使用旧路径的导入语句
2. **更新阶段**：将导入路径更新为使用新架构目录结构
3. **验证阶段**：进行构建和测试，确保更新后代码正常工作

### 3.2 导入路径更新列表

以下是需要更新的主要导入路径类型：

| 旧路径模式                                           | 新路径模式                                                | 优先级 |
| ---------------------------------------------------- | --------------------------------------------------------- | ------ |
| `import ... from "@/features/materials/..."`         | `import ... from "@/domains/materials"`                   | 高     |
| `import ... from "@/modules/materials/..."`          | `import ... from "@/domains/materials"`                   | 高     |
| `import ... from "@/features/discussion/..."`        | `import ... from "@/domains/discussions"`                 | 高     |
| `import ... from "@/features/discussions/..."`       | `import ... from "@/domains/discussions"`                 | 高     |
| `import ... from "@/features/material-search/..."`   | `import ... from "@/domains/material-search"`             | 中     |
| `import ... from "@/components/material-search/..."` | `import ... from "@/domains/material-search/external/ui"` | 中     |

## 4. 具体执行计划

### 4.1 阶段一：完成材料和讨论领域迁移（进行中）

1. [x] 创建材料领域结构和基础类
2. [x] 创建讨论领域结构和基础类
3. [x] 创建桥接组件
4. [ ] 在桥接组件中实现所有必要的 Hook 和函数
5. [ ] 测试并确保与现有功能等效

### 4.2 阶段二：迁移材料搜索功能（计划中）

1. [ ] 创建`domains/material-search`完整结构
2. [ ] 迁移组件到`external/ui`目录
3. [ ] 迁移生成器逻辑到`use-cases`目录
4. [ ] 创建/更新桥接组件
5. [ ] 测试并确保与现有功能等效

### 4.3 阶段三：更新导入路径（计划中）

1. [ ] 识别并列出所有需要更新的导入路径
2. [ ] 分批更新导入路径，优先处理核心组件
3. [ ] 每批更新后测试应用功能

### 4.4 阶段四：清理冗余代码（计划中）

1. [ ] 在确认桥接组件全部正常工作后，标记原始文件为待删除
2. [ ] 移除冗余目录
3. [ ] 进行最终测试，确保项目功能完整

## 5. 最佳实践指南

在迁移过程中，应遵循以下最佳实践：

1. **保持向后兼容性**：桥接组件应保持与原有 API 完全兼容
2. **增量迁移**：每次迁移一小部分代码，避免大规模更改
3. **频繁测试**：每完成一个小步骤就进行测试
4. **明确标记**：使用注释标记临时代码、桥接代码和待删除代码
5. **使用 Feature Flags**：对于重要更改，考虑使用特性开关

## 6. 风险与缓解策略

| 风险                       | 缓解策略                                           |
| -------------------------- | -------------------------------------------------- |
| 导入路径更新造成运行时错误 | 采用渐进式更新策略，每次更新后进行全面测试         |
| 桥接组件未完全实现原有功能 | 确保全面理解原有代码，编写单元测试验证功能等效性   |
| 用户体验在迁移过程中受影响 | 优先迁移非关键路径功能，使用特性开关控制新功能发布 |

## 7. 进度跟踪

| 任务                 | 状态      | 完成日期 | 负责人 |
| -------------------- | --------- | -------- | ------ |
| 创建材料领域基础结构 | ✅ 已完成 | -        | -      |
| 创建讨论领域基础结构 | ✅ 已完成 | -        | -      |
| 创建材料桥接组件     | ✅ 已完成 | -        | -      |
| 创建讨论桥接组件     | ✅ 已完成 | -        | -      |
| 创建材料搜索桥接组件 | ✅ 已完成 | -        | -      |
| 更新导入路径         | 🔍 计划中 | -        | -      |
| 清理冗余目录         | 🔍 计划中 | -        | -      |

## 8. 结论

通过实施本计划，我们将解决项目中的功能重复与冗余问题，同时逐步向清晰的领域驱动设计架构过渡。这将提高代码的可维护性、可测试性和模块化程度，为项目的长期发展奠定坚实基础。
